<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="/css/style.css">
<link rel="stylesheet" type="text/css" href="/css/popupModal.css">


<title>Editeur collaboratif</title>
</head>

<body>
    <div class="icon-bar">
        <a class="active" id="username"></a>
        <a href=javascript:void(0); id="loadButton"><i class="fa fa-search"></i></a>
        <a href=javascript:void(0); id="saveButton"><i class="fa fa-save"></i></a>
        <a href=javascript:void(0); id="trashButton"><i class="fa fa-trash"></i></a>
    </div>

    <h1>Éditeur collaboratif</h1>
    <h2></h2>
    <div class="format"
         role="toolbar"
         aria-label="Text Formatting"
         aria-controls="textarea1">
        <div class="group characteristics">
            <button class="item bold popup"
                    aria-pressed="false"
                    value="bold"
                    tabindex="0">
                <span class="fa fa-bold" aria-hidden="true"></span>
                <span class="popup-label">
            Bold
          </span>
            </button>
            <button class="item italic popup"
                    aria-pressed="false"
                    value="italic"
                    tabindex="-1">
                <span class="fa fa-italic" aria-hidden="true"></span>
                <span class="popup-label">
            Italic
          </span>
            </button>
            <button class="item underline popup"
                    aria-pressed="false"
                    value="underline"
                    tabindex="-1">
                <span class="fa fa-underline" aria-hidden="true"></span>
                <span class="popup-label">
            Underline
          </span>
            </button>
        </div>
        <div class="group"
             role="radiogroup"
             aria-label="Text Alignment">
            <button role="radio"
                    class="item align-left popup"
                    aria-checked="true"
                    tabindex="-1">
                <span class="fa fa-align-left" aria-hidden="true"></span>
                <span class="popup-label">
            Text Align Left
          </span>
            </button>
            <button role="radio"
                    class="item align-center popup"
                    aria-checked="false"
                    tabindex="-1">
                <span class="fa fa-align-center" aria-hidden="true"></span>
                <span class="popup-label">
            Text Align Center
          </span>
            </button>
            <button role="radio"
                    class="item align-right popup"
                    aria-checked="false"
                    tabindex="-1">
                <span class="fa fa-align-right" aria-hidden="true"></span>
                <span class="popup-label">
            Text Align Right
          </span>
            </button>
        </div>
        <div class="menu-popup group">
            <button aria-haspopup="true"
                    aria-controls="menu1"
                    class="item menu-button"
                    tabindex="-1"
                    aria-label="Font: Sans-serif"
                    style="text-align: left; width: 140px; font-family: sans-serif">
                SANS-SERIF
                <span class="decrease">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="12"
                 height="12">
              <polygon class="decrease"
                       fill="#333"
                       points="0,2 11,2 6,12"></polygon>
            </svg>
          </span>
            </button>
            <ul role="menu"
                id="menu1"
                aria-label="Font Family">
                <li role="menuitemradio"
                    aria-checked="true"
                    style="font-family: sans-serif">
                    Sans-serif
                </li>
                <li role="menuitemradio"
                    aria-checked="false"
                    style="font-family: serif">
                    Serif
                </li>
                <li role="menuitemradio"
                    aria-checked="false"
                    style="font-family: monospace">
                    Monospace
                </li>
                <li role="menuitemradio"
                    aria-checked="false"
                    style="font-family: fantasy">
                    Fantasy
                </li>
                <li role="menuitemradio"
                    aria-checked="false"
                    style="font-family: cursive">
                    Cursive
                </li>
            </ul>
        </div>
        <div class="group">
            <div class="item spinbutton"
                 role="spinbutton"
                 tabindex="-1"
                 aria-valuenow="14"
                 aria-valuetext="14pt"
                 aria-valuemin="8"
                 aria-valuemax="40"
                 aria-label="Font size in points">
          <span class="value">
            14pt
          </span>
                <span class="increase">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="12"
                 height="12">
              <polygon class="increase"
                       fill="#333"
                       points="0,12 11,12 6,2"></polygon>
            </svg>
          </span>
                <span class="decrease">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="12"
                 height="12">
              <polygon class="decrease"
                       fill="#333"
                       points="0,2 11,2 6,12"></polygon>
            </svg>
          </span>
            </div>
        </div>
    </div>

    <div>
		<textarea id="textarea1"
			rows="50"
			cols="80"
			placeholder="Ecrivez ici..."></textarea>
    </div>

    <div class="versionning">
        <div style="margin: inherit; margin-bottom: 20px; font-family: sans-serif;">
            Historique de modification du fichier en base de données
        </div>
        <div style = "overflow: hidden; overflow-y: scroll; height: 285px;">
            <div class="versio_grid" id="versio_grid">
            </div>
        </div>
    </div>
    
    <div class="bg-modal">
        <div class="modal-contents">
            <div class="close">+</div>
            <form action="">
                <div class="popupTitle">Sauvegarder</div>
                <input type="text" id="submitSaveInput" placeholder="Nom du fichier">
                <a href="#" id="submitSaveButton" class="button">Valider</a>
            </form>
        </div>
    </div>

    <div class="bg-modal2">
        <div class="modal-contentsbis">
            <div class="close2">+</div>
            <form action="" style="height: inherit;">
                <div class="popupTitle" style="margin-bottom: 30px">Sélectionnez un fichier</div>
                <div style="overflow: hidden; overflow-y: scroll; height: 360px;">
                    <div class="doc_grid" id="grid">



                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="bg-modal-login">
            <form action="">
                <div class="popupTitle loginTitle">Bienvenue !</div>
                <input type="text" id="loginInput" placeholder="Pseudo">
                <a href="#" id="loginButton" class="button">Valider</a>
            </form>
    </div>

    <div class="bg-modal3">
            <div class="modal-contentsbisbis">
                <div class="close3">+</div>
                <form action="" style="height: inherit;">
                    <div class="popupTitle" style="margin-bottom: 30px">Choisissez un fichier à supprimer</div>
                    <div style="overflow: hidden; overflow-y: scroll; height: 360px;">
                        <div class="doc_grid2" id="grid2">
    
    
    
                        </div>
                    </div>
                </form>
            </div>
        </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/user.js"></script>
    <script>
        var socket = io('http://localhost:3000');
        function getEl(id) {
            return document.getElementById(id)
        }

        var user = new User();
        user.init();

        socket.on('displaysaved', async (saved) => {
            document.getElementById("versio_grid").innerHTML = "";
            saved.forEach((file) => {
                var d = new Date(file.createdAt);
                document.getElementById("versio_grid").innerHTML += "<div> <div class='buffer'>" + file.buffer + "</div><div class='buffer_info'>Modifié par : " + file.user + "<br> Le : " + d + "</div></div>";
            })
        })

        const editor = getEl("textarea1")
        editor.addEventListener("keyup", (evt) => {
            const text = editor.value
            socket.emit('message', text)
        })
        socket.on('message', (data) => {
            editor.value = data
        });

        const saveButton = document.getElementById('saveButton');
        saveButton.onclick = function() {
            document.querySelector('.bg-modal').style.display = "flex";
        };

        const loadButton = document.getElementById('loadButton');
        loadButton.onclick = function() {
            document.querySelector('.bg-modal2').style.display = "flex";
            socket.emit('loadall');
        };

        const trashButton = document.getElementById('trashButton');
        trashButton.onclick = function() {
            document.querySelector('.bg-modal3').style.display = "flex";
            socket.emit('trashall');
        }

        document.querySelector('.close').addEventListener("click", function() {
            document.querySelector('.bg-modal').style.display = "none";
        });

        document.querySelector('.close2').addEventListener("click", function() {
            document.querySelector('.bg-modal2').style.display = "none";
        });

        document.querySelector('.close3').addEventListener("click", function() {
            document.querySelector('.bg-modal3').style.display = "none";
        });

        const submitSaveButton = document.getElementById('submitSaveButton');
        submitSaveButton.onclick = function() {
            document.querySelector('.bg-modal').style.display = "none";
            var filename = document.getElementById('submitSaveInput').value;
            socket.emit('save', filename);
            socket.emit('version', user.username, filename)
        };

        function onClickLoad(filename) {
            socket.emit('load', filename);
            document.querySelector('.bg-modal2').style.display = "none";
        }

        function onClickTrash(filename) {
            socket.emit('trash', filename);
            document.querySelector('.bg-modal3').style.display = "none";
        }

        socket.on('loadallnext', async (docs) => {
            document.getElementById("grid").innerHTML = ""
            docs.forEach((elt) => {
                document.getElementById("grid").innerHTML +=
                    "<div onclick=onClickLoad(\""+elt.fileName+"\")>" + '<img src="images/document.svg">' + "<p style='margin: 10px; font-family: sans-serif;'>" + elt.fileName + "</p></div>"
            })
        })

        socket.on('trashallnext', async (docs) => {
            document.getElementById("grid2").innerHTML = ""
            docs.forEach((elt) => {
                document.getElementById("grid2").innerHTML +=
                    "<div onclick=onClickTrash(\""+elt.fileName+"\")>" + '<img src="images/document.svg">' + "<p style='margin: 10px; font-family: sans-serif;'>" + elt.fileName + "</p></div>"
            })
        })

    </script>
    <script src="/js/fontMenu.js"></script>
    <script src="/js/fontMenuButton.js"></script>
    <script src="/js/fontMenuItem.js"></script>
    <script src="/js/fontToolbarItem.js"></script>
    <script src="/js/formatToolbar.js"></script>
    <script src="/js/spinButton.js"></script>
</body>
</html>
